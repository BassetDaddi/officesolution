<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- تحميل الخطوط والموارد بشكل أمثل -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Facebook Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '23990098767264674'); 
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" 
    src="https://www.facebook.com/tr?id=23990098767264674&ev=PageView&noscript=1"/>
  </noscript>
  <style>/* المتغيرات العامة */
    :root {
      --primary-color: #F7941D; /* اللون البرتقالي الأساسي */
      --secondary-color: #E05D00; /* اللون البرتقالي الداكن */
      --dark-color: #252628; /* اللون الأسود */
      --light-color: #f8f9fa;
      --border-color: #e0e0e0;
      --text-color: #333;
      --success-color: #28a745;
    }

    /* العناصر العامة */
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #f5f5f5;
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }

    /* حاوية النموذج */
    .order-container {
      max-width: 500px;
      margin: 30px auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      overflow: hidden;
      border-top: 5px solid var(--primary-color);
    }

    .form-header {
      padding: 15px;
      text-align: center;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
    }

    .form-header h2 {
      margin: 0;
      font-size: 16px;
    }

    .form-body {
      padding: 20px;
    }

    /* ==================== حقول الإدخال والأزرار ==================== */
input, select, textarea, button {
  width: 100%;
  padding: 12px 15px;
  margin: 8px 0;
  border-radius: 12px;
  border: 1px solid var(--border-color);
  font-size: 16px;
  box-sizing: border-box;
  font-family: 'Tajawal', sans-serif;
  transition: all 0.3s ease;
  background-color: var(--container-bg);
  color: var(--text-color);
}

button.submit-btn {
  background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
  color: white;
  border: none;
  border-radius: 12px;
  padding: 15px;
  cursor: pointer;
  font-weight: bold;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(74, 107, 255, 0.2);
}

    /* مجموعة الراديو */
    .radio-group {
      display: flex;
      gap: 10px;
      margin: 15px 0;
    }

    .radio-group input[type="radio"] {
      display: none;
    }

    .radio-group label {
      flex: 1;
      text-align: center;
      padding: 12px;
      background: var(--light-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .radio-group input[type="radio"]:checked + label {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* ملخص الطلب */
    .order-summary {
      background: rgba(247, 148, 29, 0.05);
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed var(--border-color);
    }

    .price-row:last-child {
      border-bottom: none;
    }

    .total-price {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 18px;
    }

   /* ==================== عناصر التحكم بالكمية ==================== */
.action-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.quantity-control {
  display: flex;
  align-items: center;
  border: 1px solid var(--border-color);
  border-radius: 12px;
  overflow: hidden;
  width: 120px;
  background: var(--container-bg);
}

.quantity-control button {
  background-color: rgba(74, 107, 255, 0.1);
  border: none;
  font-size: 18px;
  padding: 5px 10px;
  cursor: pointer;
  color: var(--primary-color);
  width: 40px;
  font-weight: bold;
  transition: all 0.2s ease;
}

.quantity-control button:hover {
  background-color: rgba(74, 107, 255, 0.2);
}

.quantity-control input {
  width: 12px;
  text-align: center;
  border: none;
  font-size: 16px;
  font-weight: bold;
  background: transparent;
  padding: 1px 1px;
}

    /* زر الإرسال */
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .submit-btn:hover {
      background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 5px 10px rgba(247, 148, 29, 0.3);
    }


    .social-icon:hover {
      transform: translateY(-3px);
    }

    /* زر الواتساب العائم */
    .whatsapp-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 99;
    }

    .whatsapp-button img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: all 0.3s;
    }

    .whatsapp-button img:hover {
      transform: scale(1.1);
    }

    /* تأثيرات التحقق */
    .highlight {
      animation: highlight 0.5s;
    }

    @keyframes highlight {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* التكيف مع الشاشات الصغيرة */
    @media (max-width: 600px) {
      .order-container {
        margin: 15px;
        border-radius: 10px;
      }
      
      .form-body {
        padding: 15px;
      }
      
      .radio-group {
        flex-direction: column;
      }
    }
    
    /* تكييف النموذج مع ووكومرس */
.custom-order-form-container {
    clear: both;
    margin: 20px 0;
    padding: 15px;
    background: #fff;
    border-radius: 5px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.woocommerce div.product .custom-order-form-container {
    width: 100%;
    float: none;
    margin-top: 30px;
}

@media (min-width: 768px) {
    .woocommerce div.product .custom-order-form-container {
        width: 48%;
        float: right;
        margin-left: 4%;
    }
}
</style>

<body>
  <div class="order-container">
    <div class="form-header">
      <h2>أدخل معلوماتك أسفله التوصيل متوفر 58 ولاية والدفع عند الاستلام</h2>
    </div>
    
    <div class="form-body">
      <form id="orderForm">
        <div class="input-group">
          <label for="name">الاسم الكامل</label>
          <input type="text" id="name" placeholder="أدخل اسمك الكامل" required>
        </div>
        
        <div class="input-group">
          <label for="phone">رقم الهاتف</label>
          <input type="tel" id="phone" placeholder="أدخل رقم الهاتف" required 
                 pattern="[0]{1}[5-7]{1}[0-9]{8}" style="text-align: right;">
        </div>
        
       <div class="location-selectors">
      <select id="wilayaSelect" class="p-2 border rounded" required>
        <option value="">اختر الولاية التوصيل للمنزل</option>
      </select>

      <select id="communeSelect" class="p-2 border rounded" required disabled>
        <option value="">اختر البلدية</option>
      </select>
    </div>
        
        <div class="input-group">
          <label for="address">العنوان بالتفصيل</label>
          <input type="text" id="address" placeholder="الحي، الشارع، رقم المنزل" required>
        </div>

        <div class="input-group">
          <label>طريقة التوصيل</label>
          <div class="radio-group">
            <input type="radio" id="deliveryHome" name="delivery" value="للمنزل" checked>
            <label for="deliveryHome">للمنزل</label>
            <input type="radio" id="deliveryOffice" name="delivery" value="للمكتب">
            <label for="deliveryOffice">للمكتب</label>
          </div>
        </div>

        <div class="order-summary">
          <div class="price-row">
            <span>سعر المنتج:</span>
            <span>2900 دج</span>
          </div>
          <div class="price-row">
            <span>سعر التوصيل:</span>
            <span id="deliveryPrice">اختر الولاية</span>
          </div>
          <div class="price-row total-price">
            <span>المجموع:</span>
            <span id="totalPrice">-- دج</span>
          </div>
        </div>
        
        <div style="display: flex; gap: 15px; align-items: center;">
          <div class="quantity-control">
            <button type="button" onclick="changeQuantity(-1)">-</button>
            <input type="text" id="quantity" value="1" readonly>
            <button type="button" onclick="changeQuantity(1)">+</button>
          </div>
          <button type="submit" class="submit-btn">إرسال الطلب</button>
        </div>
        <script>

// الثوابت والمتغيرات
const productPrice = 2400;
const freeShippingThreshold = 50000;
const wilayaSelect = document.getElementById('wilayaSelect');
const communeSelect = document.getElementById('communeSelect');
const deliveryPriceEl = document.getElementById('deliveryPrice');
const totalPriceEl = document.getElementById('totalPrice');
const quantityInput = document.getElementById('quantity');
const phoneInput = document.getElementById('phone');
const orderForm = document.getElementById('orderForm');
const submitBtn = document.getElementById('submitBtn');

// تحميل بيانات الولايات والبلديات
document.addEventListener('DOMContentLoaded', function() {
  loadWilayasAndCommunes();
  setupEventListeners();
  initImageGallery();
});

// تحميل بيانات الولايات والبلديات من ملف JSON
function loadWilayasAndCommunes() {
  fetch('communes.json')
    .then(response => {
      if (!response.ok) throw new Error('Network response was not ok');
      return response.json();
    })
    .then(data => {
      populateWilayas(data);
      setupWilayaChangeListener(data);
    })
    .catch(error => {
      console.error('Error loading the data:', error);
      wilayaSelect.innerHTML = '<option value="">خطأ في تحميل البيانات</option>';
    });
}

// تعبئة قائمة الولايات
function populateWilayas(data) {
  wilayaSelect.innerHTML = '<option value="">اختر الولاية التوصيل للمنزل</option>';
  
  const wilayasMap = new Map();
  data.forEach(item => {
    if (!wilayasMap.has(item.wilaya_code)) {
      wilayasMap.set(item.wilaya_code, {
        code: item.wilaya_code,
        name: item.wilaya_name
      });
    }
  });

  const sortedWilayas = Array.from(wilayasMap.values()).sort((a, b) => a.code.localeCompare(b.code));

  sortedWilayas.forEach(wilaya => {
    const option = document.createElement('option');
    option.value = wilaya.code;
    option.textContent = `${wilaya.code} - ${wilaya.name}`;
    wilayaSelect.appendChild(option);
  });
}

// إعداد مستمع لتغيير الولاية
function setupWilayaChangeListener(data) {
  wilayaSelect.addEventListener('change', function() {
    const selectedCode = this.value;
    communeSelect.innerHTML = '<option value="">اختر البلدية</option>';
    communeSelect.disabled = !selectedCode;

    if (!selectedCode) {
      updatePrices();
      return;
    }

    const communes = data.filter(item => item.wilaya_code === selectedCode);
    
    if (communes.length > 0) {
      communes.forEach(item => {
        const option = document.createElement('option');
        option.value = item.commune_name;
        option.textContent = item.commune_name;
        communeSelect.appendChild(option);
      });
    }
    
    updatePrices();
  });

  communeSelect.addEventListener('change', updatePrices);
}

// إعداد مستمعات الأحداث
function setupEventListeners() {
  orderForm.addEventListener('submit', submitOrder);
}

// تحديث الأسعار بناءً على الاختيارات
function updatePrices() {
  const wilaya = wilayaSelect.value;
  const quantity = parseInt(quantityInput.value);
  const subtotal = productPrice * quantity;
  
  if (wilaya && prices[wilaya]) {
    let deliveryPrice = prices[wilaya];
    let total = subtotal + deliveryPrice;
    
    if (subtotal >= freeShippingThreshold) {
      deliveryPrice = 0;
      total = subtotal;
      deliveryPriceEl.innerHTML = '<span style="text-decoration:line-through">' + prices[wilaya] + '</span> 0';
    } else {
      deliveryPriceEl.textContent = deliveryPrice;
    }
    
    totalPriceEl.textContent = total;
  } else {
    deliveryPriceEl.textContent = 'اختر الولاية';
    totalPriceEl.textContent = '--';
  }
}

// تغيير الكمية
function changeQuantity(change) {
  let current = parseInt(quantityInput.value);
  let newVal = current + change;
  
  if (newVal >= 1 && newVal <= 10) {
    quantityInput.value = newVal;
    quantityInput.classList.add('highlight');
    setTimeout(() => quantityInput.classList.remove('highlight'), 500);
    updatePrices();
  }
}

function submitOrder(e) {
  e.preventDefault();
  
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
  
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const wilaya = wilayaSelect.options[wilayaSelect.selectedIndex].text;
  const commune = communeSelect.value; // تغيير من .text إلى .value
  const address = document.getElementById('address').value;
  const deliveryPrice = deliveryPriceEl.textContent;
  const totalPrice = totalPriceEl.textContent;
  const quantity = quantityInput.value;
  
  const scriptURL = 'https://script.google.com/macros/s/AKfycbz-lFJDNcRdiG83Clxz8khntVXybN1HNwvI_EHf4IqWtbC6Z1aDAfE2HcgOutyWbx48/exec';
  
  const formData = new FormData();
  const productName = document.querySelector('h2').textContent; // الحصول على اسم المنتج من العنوان h2
  
  formData.append('productName', productName.trim()); // إضافة trim() لإزالة المسافات الزائدة
  formData.append('name', name);
  formData.append('phone', phone);
  formData.append('wilaya', wilaya);
  formData.append('commune', commune); // إرسال قيمة البلدية بدلاً من النص
  formData.append('address', address);
  formData.append('deliveryPrice', deliveryPrice);
  formData.append('totalPrice', totalPrice);
  formData.append('quantity', quantity);
  
  fetch(scriptURL, { method: 'POST', body: formData })
    .then(response => {
      window.location.href = 'thankyou.html';
    })
    .catch(error => {
      console.error('حدث خطأ أثناء إرسال الطلب:', error);
      alert('حدث خطأ أثناء إرسال الطلب، يرجى المحاولة مرة أخرى');
      submitBtn.disabled = false;
      submitBtn.textContent = 'إرسال الطلب';
    });
}

// زر الطلب العائم
document.addEventListener("DOMContentLoaded", function() {
  const orderNowBtn = document.getElementById("orderNowBtn");
  const nameInput = document.getElementById("name");
  const topBarHeight = document.querySelector('.top-bar').offsetHeight;

  if (orderNowBtn) {
    orderNowBtn.addEventListener("click", function() {
      const topOffset = nameInput.getBoundingClientRect().top + window.scrollY - topBarHeight - 5;
      window.scrollTo({ top: topOffset, behavior: "smooth" });
      orderNowBtn.style.display = "none";
    });

    window.addEventListener('scroll', function() {
      if (window.scrollY > 50) {
        orderNowBtn.style.display = "none";
      }
    });
  }
});
</script>

  <a class="whatsapp-button" href="https://wa.me/213797319624" target="_blank">
    <img src="https://sarlofficesolution.com.dz/wp-content/uploads/2025/06/whatsapp.png" alt="واتساب">
  </a>
</body>
</html>